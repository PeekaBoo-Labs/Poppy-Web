'use client'

import { motion, useMotionValueEvent, useScroll, useSpring, useTransform } from 'framer-motion'
import Image from 'next/image'
import { forwardRef, use, useRef, useState } from 'react'

import { Flow_Rounded } from 'next/font/google'

const flow = Flow_Rounded({
  weight: "400",
  subsets: ["latin"],
})

function Redacted({ children }: { children: React.ReactNode }) {
  return (
    <span className={flow.className}>{children}</span>
  )
}

function ProgressText({ children, progress, active }: {
  children?: React.ReactNode,
  progress: number,
  active: boolean,
}) {

  return (
    <motion.div
      className='flex gap-5'
      animate={{
        opacity: active ? 1 : 0.39,
        scale: active ? 1 : 0.9
      }}
      transition={{
        type: "spring",
        damping: 15,
        stiffness: 100,
      }}
    >
      <motion.div
        animate={{
          opacity: active ? 1 : 0,
          y: active ? 0 : -10
        }}
        className='relative w-[5px] flex-shrink-0 bg-[#AF8C0063] rounded-full overflow-hidden'
      >
        <motion.div
          className='absolute rounded-full top-0 w-[5px] bg-[#202221]'
          style={{ height: active ? progress * 100 + "%" : 0 }}></motion.div>
      </motion.div>

      <p>{children}</p>
    </motion.div>
  )
}

const StickyScroll = forwardRef(
  function StickyScroll({ scrollYProgress }: { scrollYProgress: number }, ref: React.Ref<HTMLDivElement>) {

    const scrollValue = scrollYProgress * 99.9
    const section = Math.floor(scrollValue / 25)
    const progress = (scrollValue % 25) / 25

    return (
      <div className='h-[380vh] relative z-10 pb-[100px]'>
        <div
          className="sticky top-0 flex min-h-[100vh] pt-12 pb-20 mt-7 flex-row justify-between items-center mx-20"
        >
          {/* left side */}
          <div className='w-[32%] flex flex-col gap-10' >

            <ProgressText progress={progress} active={section === 0 && scrollValue > 0}>
              <strong>A simple, intuitive user experience</strong> that guides users through the screening with ease.
            </ProgressText>

            <ProgressText progress={progress} active={section === 1}>
              <strong>Screen for a wide range of STIs</strong> providing thorough knowledge of sexual health.
            </ProgressText>

            <ProgressText progress={progress} active={section === 2}>
              <strong>Connect with local clinics</strong> for follow-up care or additional testing.
            </ProgressText>

            <ProgressText progress={progress} active={section >= 3}>
              <strong>Privacy ensured,</strong> <Redacted>sensitive</Redacted> data <Redacted>sensitive</Redacted> secure, <Redacted>sent</Redacted> screenings <Redacted>sent123</Redacted> confidential.
            </ProgressText>
          </div>

          {/* right side */}
          <div className='flex-grow flex items-start justify-end max-w-[43%]'>
            <Image className='object-contain w-full h-auto drop-shadow-[30px_39px_93px_rgba(0,0,0,0.39)]' src="/phone-placeholder.png" width={350} height={500} alt="Screenshot of demo on iPhone" />
          </div>

        </div>

        <div className='h-[400vh] w-1/2 top-0 absolute -z-10' ref={ref}></div>
      </div >
    )
  })

export default function Yellow() {
  const stickyRef = useRef(null)
  const yellowRef = useRef(null)

  const { scrollYProgress } = useScroll({
    target: stickyRef,
    offset: ["start", "end"]
  })

  const logoY = useSpring(
    useTransform(scrollYProgress, [0.8, 1], [500, 33]),
    { damping: 15, stiffness: 100 }
  )

  const [scrollPercent, setScrollPercent] = useState(0)

  useMotionValueEvent(scrollYProgress, "change", (progress) => {
    setScrollPercent(progress)
  })

  const { scrollYProgress: yellowScroll } = useScroll({
    target: yellowRef,
    offset: ['start', '600px']
  })

  const yellowScrollProgress = useTransform(yellowScroll, [0, 1], [1, 0])

  return (
    <section className='h-fit max-w-5xl w-full mx-auto'>
      <div className='bg-[#ffcc00] w-full rounded-[20px] relative shadow-lg' ref={yellowRef}>

        {/* Header */}
        <motion.div
          className='flex flex-col items-center justify-center pt-10 mx-20 gap-10'
          style={{
            // y: yellowScrollProgress
          }}
        >
          <svg className='my-8' width="280" height="54" viewBox="0 0 280 54" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g clip-path="url(#clip0_163_165)">
              <path d="M279.99 11.4C279.99 10.99 279.99 10.57 279.99 10.16C279.97 9.25 279.89 8.35 279.74 7.46C279.59 6.57 279.31 5.7 278.9 4.89C278.07 3.27 276.75 1.94 275.12 1.11C274.31 0.7 273.44 0.42 272.54 0.26C271.65 0.11 270.74 0.03 269.84 0.02C269.43 0.02 269.01 0.01 268.6 0C268.11 0 267.62 0 267.14 0C266.66 0 12.87 0 12.87 0C12.38 0 11.89 0 11.39 0C10.98 0 10.57 0.01 10.15 0.02C9.23999 0.03 8.33999 0.11 7.43999 0.26C6.54999 0.41 5.67999 0.7 4.86999 1.11C4.05999 1.52 3.32999 2.06 2.67999 2.7C2.03999 3.34 1.49999 4.08 1.08999 4.89C0.67999 5.7 0.39999 6.57 0.24999 7.46C0.0999902 8.35 0.0199902 9.26 0.00999023 10.16C-9.76585e-06 10.57 -9.76585e-06 10.99 -0.0100098 11.4V42.6C-0.0100098 43.02 -0.0100098 43.43 0.00999023 43.84C0.0199902 44.75 0.0999902 45.65 0.24999 46.54C0.39999 47.43 0.67999 48.3 1.08999 49.11C1.49999 49.92 2.03999 50.65 2.67999 51.29C3.31999 51.93 4.05999 52.47 4.86999 52.88C5.67999 53.29 6.53999 53.58 7.43999 53.73C8.32999 53.88 9.23999 53.96 10.15 53.97C10.57 53.97 10.98 53.98 11.39 53.98H12.87H267.13H268.59C269 53.98 269.42 53.98 269.83 53.97C270.73 53.96 271.64 53.88 272.53 53.73C273.43 53.58 274.29 53.29 275.11 52.88C275.92 52.47 276.66 51.93 277.29 51.29C277.93 50.65 278.47 49.92 278.89 49.11C279.3 48.3 279.58 47.43 279.73 46.54C279.88 45.65 279.96 44.74 279.98 43.84C279.98 43.42 279.98 43.01 279.98 42.6C279.99 42.11 279.99 41.62 279.99 41.12V12.87C279.99 12.38 279.99 11.89 279.98 11.4H279.99ZM278.46 40.93C278.46 41.41 278.46 41.89 278.45 42.36V43.6C278.43 44.43 278.36 45.25 278.22 46.07C278.1 46.84 277.85 47.59 277.5 48.29C277.15 48.97 276.69 49.59 276.15 50.13C275.61 50.68 274.98 51.14 274.29 51.49C273.59 51.84 272.84 52.09 272.07 52.22C271.25 52.35 270.42 52.43 269.58 52.44C269.19 52.44 268.78 52.45 268.39 52.45H266.95H11.63C11.22 52.45 10.83 52.45 10.43 52.44C9.59999 52.43 8.75999 52.36 7.93999 52.22C7.16999 52.09 6.42999 51.84 5.72999 51.49C5.03999 51.14 4.40999 50.68 3.86999 50.14C3.31999 49.6 2.85999 48.97 2.50999 48.28C2.15999 47.59 1.90999 46.84 1.78999 46.07C1.64999 45.24 1.57999 44.41 1.56999 43.57C1.56999 43.29 1.54999 42.35 1.54999 42.35V11.62C1.54999 11.62 1.55999 10.7 1.56999 10.43C1.57999 9.59 1.64999 8.76 1.78999 7.94C1.91999 7.17 2.15999 6.42 2.50999 5.73C2.85999 5.04 3.30999 4.41 3.85999 3.87C4.40999 3.32 5.03999 2.86 5.72999 2.51C6.41999 2.16 7.15999 1.92 7.92999 1.79C8.75999 1.65 9.58999 1.58 10.43 1.57L11.63 1.55H268.38L269.6 1.57C270.43 1.57 271.26 1.65 272.07 1.79C272.84 1.92 273.59 2.17 274.29 2.52C275.67 3.23 276.8 4.36 277.5 5.74C277.85 6.43 278.09 7.17 278.21 7.93C278.35 8.76 278.43 9.6 278.44 10.44V11.62C278.45 12.12 278.45 12.59 278.45 13.07V40.93H278.46Z" fill="black" />
              <path d="M182.74 26.38C182.74 21.15 186.1 17.5 190.76 17.5C195.42 17.5 198.78 21.15 198.78 26.38C198.78 31.61 195.42 35.26 190.76 35.26C186.1 35.26 182.74 31.61 182.74 26.38ZM195.7 26.38C195.7 22.64 193.66 20.21 190.76 20.21C187.86 20.21 185.82 22.63 185.82 26.38C185.82 30.13 187.86 32.55 190.76 32.55C193.66 32.55 195.7 30.13 195.7 26.38ZM207.42 35.26C205.79 35.26 204.59 34.61 203.8 33.68V39.32H200.92V22.4H203.8V23.74C204.59 22.8 205.79 22.16 207.42 22.16C210.95 22.16 212.96 25.14 212.96 28.71C212.96 32.28 210.94 35.26 207.42 35.26ZM203.72 28.35V29.09C203.72 31.42 205.06 32.74 206.84 32.74C208.93 32.74 210.06 31.11 210.06 28.71C210.06 26.31 208.93 24.68 206.84 24.68C205.06 24.68 203.72 25.98 203.72 28.35ZM220.75 35.26C217.15 35.26 214.63 32.6 214.63 28.71C214.63 24.82 217.13 22.16 220.63 22.16C224.13 22.16 226.22 24.92 226.22 28.38V29.34H217.39C217.61 31.5 218.9 32.82 220.75 32.82C222.17 32.82 223.29 32.1 223.68 30.8L226.15 31.74C225.26 33.95 223.27 35.27 220.75 35.27V35.26ZM220.61 24.58C219.12 24.58 217.97 25.47 217.54 27.17H223.32C223.3 25.78 222.43 24.58 220.61 24.58ZM228.39 35V22.4H231.27V23.74C231.99 22.9 233.12 22.16 234.75 22.16C237.39 22.16 238.97 23.98 238.97 26.7V35H236.09V27.54C236.09 25.98 235.47 24.85 233.88 24.85C232.58 24.85 231.26 25.81 231.26 27.61V35H228.38H228.39ZM247.41 17.77H250.89L257.42 35H254.32L252.83 31.06H245.39L243.93 35H240.88L247.41 17.77ZM249.09 21.18L246.4 28.38H251.82L249.08 21.18H249.09ZM262.36 17.77V35H259.29V17.77H262.36Z" fill="black" />
              <path d="M175.7 24.09C176.06 23.01 176.18 21.87 176.07 20.74C175.96 19.61 175.59 18.52 175.02 17.54C174.17 16.06 172.87 14.89 171.31 14.19C169.75 13.49 168.01 13.31 166.34 13.67C165.59 12.82 164.66 12.14 163.62 11.68C162.58 11.22 161.46 10.98 160.32 10.99C158.61 10.99 156.95 11.52 155.56 12.53C154.18 13.53 153.15 14.95 152.62 16.57C151.51 16.8 150.46 17.26 149.54 17.93C148.62 18.6 147.85 19.45 147.29 20.44C146.43 21.92 146.07 23.63 146.25 25.33C146.43 27.03 147.14 28.63 148.29 29.9C147.93 30.98 147.81 32.12 147.92 33.25C148.04 34.38 148.4 35.47 148.97 36.45C149.82 37.93 151.12 39.1 152.68 39.8C154.24 40.5 155.98 40.68 157.65 40.32C158.4 41.17 159.33 41.85 160.37 42.31C161.41 42.77 162.53 43.01 163.67 43C165.38 43 167.05 42.47 168.43 41.46C169.81 40.46 170.84 39.04 171.37 37.41C172.48 37.18 173.53 36.72 174.45 36.05C175.37 35.38 176.13 34.53 176.7 33.54C177.56 32.06 177.92 30.35 177.74 28.65C177.56 26.95 176.85 25.35 175.7 24.09ZM163.74 40.9C162.15 40.9 160.91 40.41 159.84 39.51C159.89 39.48 159.97 39.44 160.03 39.4L166.4 35.72C166.56 35.63 166.69 35.5 166.78 35.34C166.87 35.18 166.92 35 166.92 34.82V25.84L169.61 27.4C169.61 27.4 169.64 27.42 169.65 27.43C169.65 27.44 169.66 27.46 169.67 27.47V34.91C169.67 38.28 166.86 40.91 163.74 40.91V40.9ZM150.79 35.4C150.09 34.19 149.83 32.76 150.08 31.38C150.13 31.41 150.21 31.46 150.27 31.49L156.64 35.17C156.8 35.26 156.98 35.31 157.16 35.31C157.34 35.31 157.52 35.26 157.68 35.17L165.46 30.68V33.79C165.46 33.79 165.46 33.82 165.46 33.84C165.46 33.85 165.44 33.87 165.43 33.88L158.99 37.6C157.61 38.39 155.98 38.61 154.44 38.2C152.9 37.79 151.59 36.78 150.8 35.41L150.79 35.4ZM149.11 21.49C149.81 20.27 150.92 19.34 152.23 18.86V26.44C152.23 26.62 152.28 26.8 152.37 26.96C152.46 27.12 152.59 27.25 152.75 27.34L160.53 31.83L157.84 33.39C157.84 33.39 157.81 33.4 157.8 33.41C157.78 33.41 157.77 33.41 157.75 33.41L151.31 29.69C149.93 28.89 148.93 27.58 148.52 26.05C148.11 24.51 148.32 22.88 149.11 21.5V21.49ZM171.24 26.64L163.46 22.15L166.15 20.6C166.15 20.6 166.18 20.59 166.19 20.58H166.24L172.68 24.3C173.67 24.87 174.47 25.71 175 26.72C175.53 27.73 175.75 28.87 175.66 30C175.56 31.14 175.14 32.22 174.45 33.12C173.76 34.03 172.83 34.72 171.76 35.11V27.53C171.76 27.35 171.71 27.17 171.62 27.01C171.53 26.85 171.4 26.72 171.24 26.63V26.64ZM173.92 22.6C173.92 22.6 173.79 22.52 173.73 22.49L167.36 18.81C167.2 18.72 167.02 18.67 166.84 18.67C166.66 18.67 166.47 18.72 166.32 18.81L158.54 23.3V20.19C158.54 20.19 158.54 20.16 158.54 20.14C158.54 20.13 158.56 20.11 158.57 20.1L165.01 16.38C166 15.81 167.12 15.53 168.26 15.58C169.4 15.63 170.5 16 171.43 16.65C172.36 17.3 173.09 18.21 173.53 19.26C173.97 20.31 174.1 21.47 173.91 22.59L173.92 22.6ZM157.07 28.15L154.38 26.59C154.38 26.59 154.35 26.57 154.34 26.56C154.34 26.55 154.33 26.53 154.32 26.52V19.08C154.32 17.94 154.65 16.83 155.26 15.86C155.87 14.9 156.74 14.13 157.78 13.65C158.81 13.17 159.96 12.99 161.09 13.13C162.22 13.28 163.29 13.74 164.16 14.47C164.11 14.5 164.03 14.54 163.97 14.58L157.6 18.26C157.44 18.35 157.31 18.48 157.22 18.64C157.13 18.8 157.08 18.98 157.08 19.16V28.14L157.07 28.15ZM158.53 25L161.99 23L165.45 25V29L161.99 31L158.53 29V25Z" fill="black" />
              <path d="M20.6999 28.3298V34.9998H17.6299V17.7698H24.5199C28.3599 17.7698 30.7599 19.5698 30.7599 23.0498C30.7599 26.5298 28.3599 28.3298 24.5199 28.3298H20.6999ZM20.6999 25.6898H24.3499C26.5599 25.6898 27.7299 24.7298 27.7299 23.0498C27.7299 21.3698 26.5499 20.4098 24.3499 20.4098H20.6999V25.6898ZM43.2899 28.7098C43.2899 32.6198 40.7699 35.2598 37.2199 35.2598C33.6699 35.2598 31.1499 32.6198 31.1499 28.7098C31.1499 24.7998 33.6699 22.1598 37.2199 22.1598C40.7699 22.1598 43.2899 24.7998 43.2899 28.7098ZM34.0499 28.7098C34.0499 31.2798 35.2699 32.8398 37.2199 32.8398C39.1699 32.8398 40.3899 31.2798 40.3899 28.7098C40.3899 26.1398 39.1699 24.5798 37.2199 24.5798C35.2699 24.5798 34.0499 26.1398 34.0499 28.7098ZM51.1799 22.3998H53.5599L55.8199 30.7498L58.0499 22.3998H60.9099L57.1199 34.9998H54.6199L52.3199 26.7398L50.0199 34.9998H47.5199L43.7299 22.3998H46.6799L48.9599 30.7498L51.1899 22.3998H51.1799ZM67.4299 35.2598C63.8299 35.2598 61.3099 32.5998 61.3099 28.7098C61.3099 24.8198 63.8099 22.1598 67.3099 22.1598C70.8099 22.1598 72.8999 24.9198 72.8999 28.3798V29.3398H64.0699C64.2899 31.4998 65.5799 32.8198 67.4299 32.8198C68.8499 32.8198 69.9699 32.0998 70.3599 30.7998L72.8299 31.7398C71.9399 33.9498 69.9499 35.2698 67.4299 35.2698V35.2598ZM67.2899 24.5798C65.7999 24.5798 64.6499 25.4698 64.2199 27.1698H69.9999C69.9799 25.7798 69.1099 24.5798 67.2899 24.5798ZM82.0999 22.3698V25.2498C81.7399 25.1998 81.4499 25.1798 81.0399 25.1798C79.2199 25.1798 77.8199 26.3598 77.8199 28.3698V34.9898H74.9399V22.3898H77.8199V24.2598C78.3699 23.0798 79.6699 22.3198 81.2799 22.3198C81.6199 22.3198 81.8799 22.3398 82.0999 22.3698ZM88.6899 35.2598C85.0899 35.2598 82.5699 32.5998 82.5699 28.7098C82.5699 24.8198 85.0699 22.1598 88.5699 22.1598C92.0699 22.1598 94.1599 24.9198 94.1599 28.3798V29.3398H85.3299C85.5499 31.4998 86.8399 32.8198 88.6899 32.8198C90.1099 32.8198 91.2299 32.0998 91.6199 30.7998L94.0899 31.7398C93.1999 33.9498 91.2099 35.2698 88.6899 35.2698V35.2598ZM88.5499 24.5798C87.0599 24.5798 85.9099 25.4698 85.4799 27.1698H91.2599C91.2399 25.7798 90.3699 24.5798 88.5499 24.5798ZM100.96 35.2598C97.4299 35.2598 95.4199 32.2798 95.4199 28.7098C95.4199 25.1398 97.4399 22.1598 100.96 22.1598C102.59 22.1598 103.79 22.8098 104.58 23.7398V17.7598H107.46V34.9898H104.58V33.6698C103.79 34.6098 102.59 35.2498 100.96 35.2498V35.2598ZM104.66 28.3498C104.66 25.9698 103.32 24.6798 101.54 24.6798C99.4499 24.6798 98.3199 26.3098 98.3199 28.7098C98.3199 31.1098 99.4499 32.7398 101.54 32.7398C103.32 32.7398 104.66 31.4198 104.66 29.0898V28.3498ZM122.05 35.2598C120.42 35.2598 119.22 34.6098 118.43 33.6798V34.9998H115.55V17.7698H118.43V23.7498C119.22 22.8098 120.42 22.1698 122.05 22.1698C125.58 22.1698 127.59 25.1498 127.59 28.7198C127.59 32.2898 125.57 35.2698 122.05 35.2698V35.2598ZM118.35 28.3498V29.0898C118.35 31.4198 119.69 32.7398 121.47 32.7398C123.56 32.7398 124.69 31.1098 124.69 28.7098C124.69 26.3098 123.56 24.6798 121.47 24.6798C119.69 24.6798 118.35 25.9798 118.35 28.3498ZM134.93 36.1698C134.21 38.0898 133.11 39.4098 130.49 39.4098C129.89 39.4098 129.72 39.3898 129.31 39.3398V36.9198C129.69 36.9698 129.91 36.9898 130.27 36.9898C131.23 36.9898 131.69 36.7298 132.09 35.7198L132.57 34.5398L127.99 22.3998H131.01L134.11 31.2298L137.13 22.3998H140.11L134.93 36.1798V36.1698Z" fill="black" />
            </g>
          </svg>

          <h1 className='largeTitle font-medium text-center'>Supercharged by GPT-4</h1>
          <p className='text-center max-w-2xl'><strong>Leverage the speed of AI</strong> to give quick results, reducing wait times traditionally associated with lab tests.</p>
        </motion.div>

        <motion.div
          className='block border-1 border-b border-[#20222163] mx-20'
          style={{
            y: '9vh',
            scaleX: yellowScrollProgress
          }}
        ></motion.div>


        <StickyScroll scrollYProgress={scrollPercent} ref={stickyRef} />


        <motion.div className='absolute bottom-0 w-full overflow-hidden'>
          <motion.img
            className='w-full origin-top'
            src="/poppyFull.svg" alt=""
            style={{
              scale: 1.05,
              y: logoY
            }}
          />
        </motion.div>
      </div>

    </section>
  )

}